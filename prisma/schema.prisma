generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url = env("DATABASE_URL")
}

enum UserRole {
    ADMIN
    USER
}

enum DishStatus {
    PENDING
    REJECTED
    ACCEPTED
}

model Users {
    id Int @id @default(autoincrement())
    username String
    email String @unique
    password String
    salt String
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    role UserRole @default(USER)

    dishes Dishes[]
}

model Dishes {
    id Int @id @default(autoincrement())
    name String @unique
    description String?
    recipe String?
    cookingTime Int? // время приготовления в минутах
    image String?
    authorId Int
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    status DishStatus @default(PENDING)

    author Users @relation(fields: [authorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    ingredients DishIngredients[]
}

model Ingredients {
    id Int @id @default(autoincrement())
    name String @unique
    abbreviation String
    glycemicIndex Float
    breadUnitsIn1g Float
    caloriesPer100g Float @default(0)
    unit String @default("g")

    dishes DishIngredients[]
}

model DishIngredients {
    dishId Int
    ingredientId Int
    quantity Float
    unit String @default("g")
    dish Dishes @relation(fields: [dishId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    ingredient Ingredients @relation(fields: [ingredientId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    @@id([dishId, ingredientId])
    @@index([dishId])
    @@index([ingredientId])
}